# 교회 예배 출석 체크 어플리케이션 - PRD

## 1. 프로젝트 개요
- **제품명**: 교회 예배 출석 체크 어플리케이션 (프로토 타입)
- **목적**: 교회 구성원의 예배 출석을 자동화하여 빠르게 테스트 가능한 프로토 타입 개발

## 2. 기술 스펙
- **클라이언트**: Flutter (iOS/Android 지원)
- **서버**: Supabase(PostgREST)
- **인증**: 이메일/비밀번호(테스트 계정), Supabase Auth
- **백그라운드 실행**: Android WorkManager + geolocator. iOS는 별도 설계 필요

## 3. 핵심 기능
### 3.1 예배 시간 설정
- 매주 일요일 9:00~12:00 (3시간) 동안 활성화
- 30분 간격으로 자동 출석 체크

### 3.2 GPS 위치 기반 출석 체크
- 교회 위치에서 80m 이내에 있을 경우 자동 출석 체크
- Android: 백그라운드 위치 수집 지원(WorkManager 3분 테스트/15분 이상 권장)
- iOS: 제한적. Background Modes/지오펜싱/포그라운드 서비스 대안 검토 필요

### 3.3 간단한 인증 시스템
- 테스트용 단일 계정으로 로그인 (ID/PW 방식)
- 앱 실행 상태와 무관하게 작동

## 4. 기술 요구사항
### 4.1 클라이언트 (Flutter)
- 위치 서비스 권한 관리
- 백그라운드 위치 수집 및 전송
- 간단한 UI 구성 (로그인, 출석 현황)

### 4.2 서버 (Supabase)
- 사용자 정보 저장 (테스트용 단일 계정)
- 예배 일정 및 출석 기록 관리
- 위치 데이터 수신 및 처리

## 5. 성능 요구사항(현 실험값)
- 포그라운드 위치 스트림: 10초(거리 10m)
- 백그라운드: 테스트 모드 3분 OneOff 재스케줄(+버스트 15초 간격)
- WorkManager 반복작업은 15분 미만 보장 불가 → OneOff 재스케줄로 대체
- 배터리/절전 정책에 영향 받음(문서 참고)

## 6. 보안 요구사항
- 테스트용 단일 계정 사용 (실제 배포 시 변경 예정)
- 위치 데이터 암호화 전송
- 인증된 사용자만 출석 체크 가능

## 7. 제약 및 정책
- Doze/App Standby로 짧은 간격 백그라운드 주기 보장 어려움
- 제조사 절전(삼성 등) 예외 설정 필요(배터리 최적화 해제)
- DNS/네트워크 일시 장애 시 오프라인 큐 필요(향후 계획)

## 7. 개발 우선순위
1. **핵심 기능 구현** (GPS 기반 출석 체크)
2. **백그라운드 실행 지원**
3. **간단한 로그인 시스템**
4. **UI 구성**

## 8. 테스트 계획
- 단일 사용자 테스트용 환경 구축
- 백그라운드 위치 수집 기능 테스트
- 예배 시간대 출석 체크 정확도 검증

## 9. 프로젝트 일정 (프로토 타입)
- **설계**: 1일
- **핵심 기능 개발**: 3일
- **백그라운드 실행 구현**: 2일
- **테스트 및 디버깅**: 1일
- **총 소요 시간**: 약 7일

## 10. 예상 결과
- 백그라운드에서 위치 정보 수집 가능한 프로토 타입
- 간단한 로그인을 통한 출석 체크 기능 구현
- 교회 위치에서 80m 범위 내 출석 자동 인식 가능

## 11. 변경 이력(요약)
- 2025-09-05: 백그라운드 3분 주기 + 15초 버스트 저장 추가, 세션 부재 시 access token 이메일 디코딩으로 저장 시도 경로 도입
- 2025-09-05: 포그라운드 10초 주기/거리 10m 정책 명시, WorkManager 15분 제약 명시
